# Buckling Mode Experimental Analysis

A Python package for analyzing buckling test data and extracting maximum force values from CSV files generated by experimental testing equipment.

## Features

- **Load and parse buckling test CSV files** with automatic metadata extraction
- **Extract maximum force values** from experimental data
- **Generate comprehensive summary reports** with statistics
- **Group analysis by can height** and test conditions
- **Identify special test conditions** from filename annotations
- **Command-line interface** for batch processing
- **Flexible output options** with customizable directories

## Installation

```bash
# Clone the repository
git clone <repository-url>
cd buckling-mode-experimental-analysis

# Install using poetry (recommended)
poetry install

# Activate the poetry environment
poetry shell
```

## Quick Start

```bash
# Basic analysis - outputs to current directory
poetry run buckling_mode_experimental_analysis -d data/2025-09-11

# Save results to specific directory
poetry run buckling_mode_experimental_analysis -d data/2025-09-11 -o results/

# Process only specific files with verbose output
poetry run buckling_mode_experimental_analysis -d data/2025-09-11 -o results/ --pattern "*40mm*.csv" -v
```

## Usage

### Command Line Interface

```bash
# Show all available options
poetry run buckling_mode_experimental_analysis --help

# Basic usage
poetry run buckling_mode_experimental_analysis -d data/2025-09-11

# With custom output directory (creates directory if it doesn't exist)
poetry run buckling_mode_experimental_analysis -d data/2025-09-11 -o analysis_results/

# With verbose logging for debugging
poetry run buckling_mode_experimental_analysis -d data/2025-09-11 -o results/ -v

# Process only specific file patterns
poetry run buckling_mode_experimental_analysis -d data/2025-09-11 --pattern "*60mm*.csv"
poetry run buckling_mode_experimental_analysis -d data/2025-09-11 --pattern "*falsePeak*.csv"
```

### Available Options

| Option | Short | Description | Default |
|--------|-------|-------------|---------|
| `--data-dir` | `-d` | Directory containing CSV files (required) | - |
| `--output-dir` | `-o` | Output directory for results | Current directory |
| `--pattern` | - | File pattern to match | `*.csv` |
| `--verbose` | `-v` | Enable verbose logging | False |
| `--help` | `-h` | Show help message | - |
| `--version` | - | Show version number | - |

### Programmatic Usage

```python
from buckling_mode_experimental_analysis import load_file_TT, extract_max_force_from_df
from pathlib import Path

# Load a single file
df = load_file_TT("data/90mm_05.csv")
max_force = extract_max_force_from_df(df)

# Access metadata
print(f"Can height: {df.meta.can_height}")
print(f"Run number: {df.meta.test_run}")
print(f"Notes: {df.meta.notes}")
print(f"Max force: {max_force:.4f} N")

# Process multiple files
from buckling_mode_experimental_analysis import process_csv_files, generate_summary_report

data_dir = Path("data/2025-09-11")
output_dir = Path("results")
results = process_csv_files(data_dir)
generate_summary_report(results, output_dir)
```

## File Format Requirements

### CSV Structure

The tool expects CSV files with this specific format:
```
"1 _ 1",,                    # Row 1: Metadata (ignored)
"Time","Force","Stroke"      # Row 2: Headers 
"sec","N","mm"               # Row 3: Units
"0","0.01033147","3.333E-05" # Row 4+: Data
"0.01","0.0166893","0.0002"
...
```

### Filename Convention

Files must follow the naming pattern: `{can_height}_{notes}_{run_number}.csv`

**Examples:**
- `90mm_05.csv` → Height: 90mm, Run: 05, Notes: (none)
- `40mm_falsePeak_03.csv` → Height: 40mm, Run: 03, Notes: falsePeak
- `80mm_dualPeakAtMode1_02.csv` → Height: 80mm, Run: 02, Notes: dualPeakAtMode1
- `60mm_sm1stPeak-maxAt2ndPeak_03.csv` → Height: 60mm, Run: 03, Notes: sm1stPeak-maxAt2ndPeak

**Parsing Rules:**
- Split filename on `_` (underscores)
- `[0]` = Can height (e.g., "90mm")
- `[-1]` = Run number (e.g., "05") 
- `[1:-1]` = Notes about special conditions (joined with underscores)

## Output Files

The tool generates several output files in the specified output directory:

### 1. `max_force_summary.csv`
Detailed results for all processed files:
```csv
Filename,Can_Height,Run_Number,Notes,Max_Force_N,Data_Points,Filepath
90mm_05.csv,90mm,05,,311.9834,4240,/path/to/data/90mm_05.csv
40mm_falsePeak_03.csv,40mm,03,falsePeak,145.2341,3890,/path/to/data/40mm_falsePeak_03.csv
```

### 2. `height_summary.csv`
Statistical summary grouped by can height:
```csv
Can_Height,Count,Mean_Force,Std_Force,Min_Force,Max_Force
30mm,6,89.2345,12.3456,75.1234,105.6789
40mm,15,156.7890,23.4567,134.5678,189.0123
```

## Example Output

```
======================================================================
OVERALL STATISTICS
======================================================================
Total files processed: 85
Maximum force: 450.1234 N
Minimum force: 67.8901 N
Average force: 234.5678 N
Std deviation: 89.0123 N

======================================================================
STATISTICS BY CAN HEIGHT
======================================================================
           Count  Mean_Force  Std_Force  Min_Force  Max_Force
Can_Height                                                    
30mm           6    89.2345     12.3456    75.1234   105.6789
40mm          15   156.7890     23.4567   134.5678   189.0123
50mm           5   198.4567     15.7890   178.9012   220.3456
60mm          16   267.8901     34.5678   201.2345   312.4567
70mm           6   298.1234     28.9012   256.7890   334.5678
80mm           5   356.7890     41.2345   298.4567   398.9012
90mm           6   378.9123     38.4567   323.4567   421.2345
100mm          6   398.1234     29.3456   356.7890   435.6789
110mm          6   412.3456     25.6789   378.9012   445.6789
120mm          6   423.4567     22.1234   389.0123   450.1234

======================================================================
FILES WITH SPECIAL CONDITIONS
======================================================================
  40mm_falsePeak_03.csv              | 40mm     | Notes: falsePeak
  40mm_multiPeak_02.csv              | 40mm     | Notes: multiPeak
  40mm_weird_01.csv                  | 40mm     | Notes: weird
  40mm_widePeak_13.csv               | 40mm     | Notes: widePeak
  50mm_doublePeak_05.csv             | 50mm     | Notes: doublePeak
  60mm_sm1stPeak-maxAt2ndPeak_03.csv | 60mm     | Notes: sm1stPeak-maxAt2ndPeak
  80mm_dualPeakAtMode1_02.csv        | 80mm     | Notes: dualPeakAtMode1
  80mm_widePeakAtMode1_03.csv        | 80mm     | Notes: widePeakAtMode1

======================================================================
TOP 5 HIGHEST FORCES
======================================================================
  1. 120mm_03.csv                    | 120mm    |   450.1234 N
  2. 120mm_05.csv                    | 120mm    |   448.9876 N
  3. 110mm_04.csv                    | 110mm    |   445.6789 N
  4. 120mm_02.csv                    | 120mm    |   443.2109 N
  5. 120mm_01.csv                    | 120mm    |   441.8765 N
```

## Development

### Setup Development Environment

```bash
# Clone and setup
git clone <repository-url>
cd buckling-mode-experimental-analysis
poetry install

# Install pre-commit hooks
poetry run pre-commit install
```

### Code Quality Tools

```bash
# Format and lint code
poetry run ruff format
poetry run ruff check

# Run tests
poetry run pytest

# Run with coverage
poetry run pytest --cov=buckling_mode_experimental_analysis
```

### Project Structure

```
buckling-mode-experimental-analysis/
├── README.md                    # This file
├── pyproject.toml              # Poetry configuration
├── src/
│   └── buckling_mode_experimental_analysis/
│       ├── __init__.py         # Package initialization
│       ├── __main__.py         # Entry point for -m execution
│       └── cli.py              # Main CLI and analysis functions
├── tests/
│   └── test_import.py         # Tests
└── data/                      # Example data directory
    └── 2025-09-11/
        ├── 30mm_00.csv
        ├── 40mm_falsePeak_03.csv
        └── ...
```

## Requirements

- **Python 3.11+**
- **pandas 2.3+**
- **Poetry** (for dependency management)

## Troubleshooting

### Command Not Found
If `poetry run buckling_mode_experimental_analysis` doesn't work:

```bash
# Try reinstalling
poetry install

# Or run as module
poetry run python -m buckling_mode_experimental_analysis -d data/2025-09-11

# Or run directly
poetry run python src/buckling_mode_experimental_analysis/cli.py -d data/2025-09-11
```

### File Format Issues
- Ensure CSV files follow the expected format (3 header rows, then data)
- Check that filenames follow the `{height}_{notes}_{run}.csv` pattern
- Use `-v` flag for verbose logging to debug file parsing issues

### Common Patterns
```bash
# Process only certain heights
poetry run buckling_mode_experimental_analysis -d data/2025-09-11 --pattern "*40mm*.csv"

# Process only files with special conditions
poetry run buckling_mode_experimental_analysis -d data/2025-09-11 --pattern "*Peak*.csv"

# Debug file parsing issues
poetry run buckling_mode_experimental_analysis -d data/2025-09-11 -v
```

## License

GPL-3.0-or-later - see LICENSE file for details.

## Contributing

1. Fork the repository
2. Create a feature branch
3. Make your changes
4. Run tests and linting
5. Submit a pull request
