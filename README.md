# Buckling Mode Experimental Analysis

A Python package for analyzing buckling test data and extracting maximum force values from CSV files generated by experimental testing equipment.

## Features

- **Load and parse buckling test CSV files** with automatic metadata extraction
- **Extract maximum force values** from experimental data
- **Generate comprehensive summary reports** with statistics
- **Group analysis by can height** and test conditions
- **Identify special test conditions** from filename annotations
- **Command-line interface** for batch processing
- **Flexible output options** with customizable directories

## Installation

```bash
# Clone the repository
git clone git@github.com:nanosystemslab/Buckling_Mode_Experimental_Analysis.git
cd buckling-mode-experimental-analysis

# Install using poetry (recommended)
poetry install

# Activate the poetry environment
poetry shell
```

## Quick Start

```bash
# Basic analysis - outputs to current directory
poetry run buckling_mode_experimental_analysis -d data/2025-09-11

# Save results to specific directory
poetry run buckling_mode_experimental_analysis -d data/2025-09-11 -o results/

# Process only specific files with verbose output
poetry run buckling_mode_experimental_analysis -d data/2025-09-11 -o results/ --pattern "*40mm*.csv" -v
```

## Usage

### Command Line Interface

```bash
# Show all available options
poetry run buckling_mode_experimental_analysis --help

# Basic usage
poetry run buckling_mode_experimental_analysis -d data/2025-09-11

# With custom output directory (creates directory if it doesn't exist)
poetry run buckling_mode_experimental_analysis -d data/2025-09-11 -o analysis_results/

# With verbose logging for debugging
poetry run buckling_mode_experimental_analysis -d data/2025-09-11 -o results/ -v

# Process only specific file patterns
poetry run buckling_mode_experimental_analysis -d data/2025-09-11 --pattern "*60mm*.csv"
poetry run buckling_mode_experimental_analysis -d data/2025-09-11 --pattern "*falsePeak*.csv"
```

### Available Options

| Option | Short | Description | Default |
|--------|-------|-------------|---------|
| `--data-dir` | `-d` | Directory containing CSV files (required) | - |
| `--output-dir` | `-o` | Output directory for results | Current directory |
| `--pattern` | - | File pattern to match | `*.csv` |
| `--verbose` | `-v` | Enable verbose logging | False |
| `--help` | `-h` | Show help message | - |
| `--version` | - | Show version number | - |

### Programmatic Usage

```python
from buckling_mode_experimental_analysis import load_file_TT, extract_max_force_from_df
from pathlib import Path

# Load a single file
df = load_file_TT("data/90mm_05.csv")
max_force = extract_max_force_from_df(df)

# Access metadata
print(f"Can height: {df.meta.can_height}")
print(f"Run number: {df.meta.test_run}")
print(f"Notes: {df.meta.notes}")
print(f"Max force: {max_force:.4f} N")

# Process multiple files
from buckling_mode_experimental_analysis import process_csv_files, generate_summary_report

data_dir = Path("data/2025-09-11")
output_dir = Path("results")
results = process_csv_files(data_dir)
generate_summary_report(results, output_dir)
```

## File Format Requirements

### CSV Structure

The tool expects CSV files with this specific format:
```
"1 _ 1",,                    # Row 1: Metadata (ignored)
"Time","Force","Stroke"      # Row 2: Headers 
"sec","N","mm"               # Row 3: Units
"0","0.01033147","3.333E-05" # Row 4+: Data
"0.01","0.0166893","0.0002"
...
```

### Filename Convention

Files must follow the naming pattern: `{can_height}_{notes}_{run_number}.csv`

**Examples:**
- `90mm_05.csv` → Height: 90mm, Run: 05, Notes: (none)
- `40mm_falsePeak_03.csv` → Height: 40mm, Run: 03, Notes: falsePeak
- `80mm_dualPeakAtMode1_02.csv` → Height: 80mm, Run: 02, Notes: dualPeakAtMode1
- `60mm_sm1stPeak-maxAt2ndPeak_03.csv` → Height: 60mm, Run: 03, Notes: sm1stPeak-maxAt2ndPeak

**Parsing Rules:**
- Split filename on `_` (underscores)
- `[0]` = Can height (e.g., "90mm")
- `[-1]` = Run number (e.g., "05") 
- `[1:-1]` = Notes about special conditions (joined with underscores)

## Output Files

The tool generates several output files in the specified output directory:

### 1. `max_force_summary.csv`
Detailed results for all processed files:

### 2. `height_summary.csv`
Statistical summary grouped by can height:

## Development

### Setup Development Environment

```bash
# Clone and setup
git clone <repository-url>
cd buckling-mode-experimental-analysis
poetry install

# Install pre-commit hooks
poetry run pre-commit install
```

### Code Quality Tools

```bash
# Format and lint code
poetry run ruff format
poetry run ruff check

# Run tests
poetry run pytest

# Run with coverage
poetry run pytest --cov=buckling_mode_experimental_analysis
```

### Project Structure

```
buckling-mode-experimental-analysis/
├── README.md                    # This file
├── pyproject.toml              # Poetry configuration
├── src/
│   └── buckling_mode_experimental_analysis/
│       ├── __init__.py         # Package initialization
│       ├── __main__.py         # Entry point for -m execution
│       └── cli.py              # Main CLI and analysis functions
├── tests/
│   └── test_import.py         # Tests
└── data/                      # Example data directory
    └── 2025-09-11/
        ├── 30mm_00.csv
        ├── 40mm_falsePeak_03.csv
        └── ...
```

## Requirements

- **Python 3.11+**
- **pandas 2.3+**
- **Poetry** (for dependency management)

## Troubleshooting

### Command Not Found
If `poetry run buckling_mode_experimental_analysis` doesn't work:

```bash
# Try reinstalling
poetry install

# Or run as module
poetry run python -m buckling_mode_experimental_analysis -d data/2025-09-11

# Or run directly
poetry run python src/buckling_mode_experimental_analysis/cli.py -d data/2025-09-11
```

### File Format Issues
- Ensure CSV files follow the expected format (3 header rows, then data)
- Check that filenames follow the `{height}_{notes}_{run}.csv` pattern
- Use `-v` flag for verbose logging to debug file parsing issues

### Common Patterns
```bash
# Process only certain heights
poetry run buckling_mode_experimental_analysis -d data/2025-09-11 --pattern "*40mm*.csv"

# Process only files with special conditions
poetry run buckling_mode_experimental_analysis -d data/2025-09-11 --pattern "*Peak*.csv"

# Debug file parsing issues
poetry run buckling_mode_experimental_analysis -d data/2025-09-11 -v
```

## License

GPL-3.0-or-later - see LICENSE file for details.

## Contributing

1. Fork the repository
2. Create a feature branch
3. Make your changes
4. Run tests and linting
5. Submit a pull request
